name: Build Windows

on: workflow_dispatch: push: branches: [ main ]

jobs: build-windows: runs-on: windows-latest

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Setup Haxe
    uses: krdlab/setup-haxe@v1
    with:
      haxe-version: 4.2.5

  - name: Setup haxelib
    run: haxelib setup C:\haxelib

  - name: Install libraries
    run: |
      haxelib install lime --quiet
      haxelib install openfl --quiet
      haxelib install flixel --quiet
      haxelib install flixel-addons --quiet
      haxelib install flixel-ui --quiet

  - name: Lime setup
    run: haxelib run lime setup

  - name: Build Windows
    run: haxelib run lime build windows -release

  - name: List build output
    run: dir export /s

  - name: Upload artifact
    uses: actions/upload-artifact@v4
    with:
      name: KareshiProject-Windows
      path: export/release/windows/**